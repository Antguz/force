Processing
==========


Processing
The core module of FORCE TSA is force-tsa, which extracts time series and performs time series analyses. The processed images are written to the output directory given in the TSA parameter file (see section VII.E for all available options).
Module	|	force-tsa

Usage	|	force-tsa     par-file

The parameter file needs to be given as 1st argument. All options need to be specified in the parameter file.

Quick guide
FORCE TSA is not covered by a scientific publication. Therefore, this section briefly summarizes the key functionality; Fig. 5 depicts the general workflow within FORCE TSA; see also section VII.E for all available options and possible keywords.
The analysis can be constrained to a certain area. The general extent in tile coordinates should be specified, a tile white-list may be used and analysis masks may be input. These need to be prepared as specified in the analysis mask subsection.
The analysis can be performed with observations from all available sensors, or a subset of these. If multiple sensors are used, only overlapping bands are considered. Note that no spectral adjustment is made. The program will exit with an error message if the requested index is not available for the chosen sensor set.
The spatial resolution on which the analysis is performed, needs to be given too. Image decimation/replication is taken care of using nearest neighbor resampling. Alternatively, spatial resolution may be reduced using approximated Point Spread Functions (PSF). The PSFs are parameterized with Full Width at Half Maximum (FWHM) corresponding to the size of one pixel at the target resolution.
A temporal subset can be specified in terms of years, months, and DOYs. The most restrictive seasonal subset is used. As an example, if the min–max days are set to 1–200 and the min–max month are set to 3–12, only acquisitions between DOY 60 and 200 are used. The years can be further subsetted, e.g. a trend analysis can be performed on all July–August images for the years 2000–2010.
In the next step, a spectral band (e.g. NIR), spectral index (e.g. NDVI), or Spectral Mixture Analysis (SMA) is selected. The full (or subset) time series corresponding to this ‘index’ is generated, quality-controlled, and potentially output. It is also possible to center (or standardize) each pixel’s time series to its mean (and standard deviation) before output. All products indicated by a USB-plug in Fig. 5 can be output; all products indicated by * can be centered / standardized before output.
In the case of SMA, a endmember file needs to be provided (see VII.F). Only the abundance image related to one endmember is retained. The SMA can be constrained (Sum-to-One and/or Non-Negativity), and the fractions can be shade normalized. The shade spectrum (photogrammetric zero or measured shade) needs to go into the last column of the endmember file. The RMSE time series of the SMA can be output.
Quality control is in full user control. All provided quality flags (see VI.B.5) can be used individually. Use this option rigorously!
In the next step, a summary of the full time series can be generated. Basic statistics include mean, standard deviation, minimum and maximum.
The time series can be interpolated / smoothed at custom time steps. Currently available are linear interpolation, moving average filter, and Radial Basis Function (RBF) ensembles. The RBF kernel strengths are adapted by weighting with actual data availability within the time period covered by each kernel.
Afterward, the full time series are aggregated before performing a time series analysis. The user can choose to ‘fold’ the full time series by year, month, week or day. If folded by year, the observations are grouped by year to generate an annual time series. If folded by month, the observations are grouped by months, which gives up to 12 values per pixel. If folded by week, the observations are grouped by week numbers (starting with DOY 1), which gives up to 52 values per pixel; note that the last week contains some more days. If folded by day, the observations are grouped by DOY, which gives up to 365 values per pixel. The time series can be folded with mean, minimum or maximum statistics. The user can request to output any of these folded time series, but the following trend analysis can only be performed on one.
Alternatively, the interpolated time series can be folded by year with LSP method, which means that annual Land Surface Phenology (LSP) metrics are extracted. The extraction of LSP is performed by the SPLITS code, which is a spline-based methodology. Note that FORCE needs to be compiled with enabled SPLITS (see IV.F). The number of segments for fitting the splines needs to be specified (in segments per 365 days); more segments give a more detailed fit; the detail vs. smoothing capability of the spline needs to be considered with respect to application, land cover of interest and data density. Deriving LSP will only work nicely if data availability throughout the year is high; do not expect good results for sparse data. To derive LSP metrics for a given year, some data from the previous and next year need to be included, as the early/late minima may not be found in the year of interest (the data range can be specified by the user). The same can be true for the peak. The user can select if a Northern hemisphere (peak assumed in the middle of the year), Southern hemisphere (peak is assumed around the turn of the year) or mixed phenology (both can happen, and FORCE TSA should attempt to decide for each pixel) should be assumed. In total, 26 LSP metrics will be derived for each year (see output subsection). All metrics will be output if LSP output is requested (this will give 26 physical files). 
In a final step, time series analyses can be performed on the folded time series. The user can choose, which folded time series to use (daily, weekly, monthly or annual – folded with mean, min, max, or LSP). In case of annual LSP time series, the analysis is performed for each LSP metric (this will give you 26 physical files). Currently implemented analyses are linear trend analysis, and an extended CAT transform (with additional change and trend parameters for the three parts of the time series; see output subsection).
 
Fig. 5. Workflow of FORCE TSA. 
The processing is done for each requested tile.

Analysis masks
A mask dataset may be input to constrain the analysis to a certain area or land cover. This is optional. If no masks are given, the full image extent is used. The mask dataset needs to be prepared in the same grid as the Level 2 data (i.e. in a mirrored data structure). The filenames must contain the keyword ‘MASK’. The data are expected to be in ENVI standard or GeoTiff format with file extension *.dat/tif, *.hdr. Each file is a binary image with 1 for the ‘on’ pixels, 0 for the ‘off’ pixels.
