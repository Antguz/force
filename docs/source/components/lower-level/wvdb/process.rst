Processing
==========

Generation
The water vapor database may be generated/updated with force-lut-modis, which automatically downloads MODIS water vapor products (MOD05 and MYD05, collection 6.1) from the Level1 and Atmosphere Archive and Distribution System (LAADS) at NASA’s Goddard Space Flight Center. Note that any permanent or temporary change/shutdown/decommissioning on LAADS’ or MODIS’ end may result in the nonfunctioning of force-lut-modis (as it happened between the release of FORCE v. 1.1 and v. 2.0). The data are processed to supply daily and climatological water vapor averages per given coordinate (± 0.5°). 
The usage of this tool is not mandatory, but water vapor tables are needed for the radiometric processing of Landsat data (unless one single dummy value is specified in the Level 2 parameter file). However, the tables can also be generated with other data and/or software. If you want to create the tables on your own, refer to the file format description (see section VII.J).
An application-ready global water vapor database (daily values for 2000–July 2018 + monthly climatology) can be downloaded from https://doi.org/10.1594/PANGAEA.893109. 

Module	|	force-lut-modis

Usage	|	force-lut-modis     coords     dir-wvp     dir-geometa     dir-eoshdf
                                                                       [start-year     start-month     start-day]
                                                                       [end-year      end-month      end-day]

The first four arguments are mandatory, the start and end arguments are optional and may be used for parallelization during the initial build.
A text file with coordinates needs to be given as 1st argument. Water vapor averages are estimated for each given coordinate. The file should contain two columns separated by white space, and no header. The first column should give the longitude, the second column the latitude with coordinates in decimal degree (negative values for West/South), see section VII.J.
The MODIS data are downloaded to dir-eoshdf (this directory must exist). MODIS data that are already in dir-eoshdf are not downloaded again. If the tool crashes because a dataset is corrupt, it is necessary to manually delete this file and run the tool again. Unfortunately, this happens from time to time due to incomplete downloads or if LAADS is unresponsive. The program attempts to re-download a corrupt file up to 10 times, but this error can occur nonetheless.
MOD05/MYD05 data are swath products, and MOD03/MYD03 geometa tables are necessary to relate coordinates to MODIS granules. The geometa tables are downloaded to dir-geometa (this directory must exist). Tables that are already in dir-geometa are not downloaded again. If the tool crashes because a table is invalid, it is necessary to manually delete this file and run the tool again. Unfortunately, this happens from time to time due to incomplete downloads or if LAADS is unresponsive. The program attempts to re-download a corrupt file up to 10 times, but this error can occur nonetheless. Note that the geometa tables are a global product, and as such, the same dir-geometa can be used for different projects (≙ study areas).
The final water vapor tables are saved in dir-wvp (this directory must exist). Tables that are already in dir-wvp are not processed again (i.e. no download of geometa tables and hdf files; the user may delete the MODIS *.hdf files after the water vapor tables are successfully generated.). This directory is the directory, to which DIR_WVPLUT in the Level 2 parameter file (see section VII.A) should refer.
MODIS data are not available for each day (pre-MODIS era, sensor outages, clouds…). Therefore, we use a climatology as fallback option. The climatology is the monthly long-time average of the daily values. The climatology is generated after processing the daily values. It is strongly recommended to re-run the tool – in sequential mode – after all the daily tables were successfully generated (to have a clean version of the climatology tables). This is especially mandatory if the tool was run in parallel during the initial build.
The initial build of the database might take some time – strongly depends on the size of the study area. This is mainly due to the download of MODIS data . It is possible to speed up the work by parallel calls to force-lut-modis. However, note that LAADS restricts the number of running downloads and may permanently block your IP address (LAADS FAQ). The optional start and end dates may be used for parallelization, e.g. one processor per year.
Example for the initial build using GNU parallel:
seq -w 2000 2017 | parallel –j18 force-lut-modis coords dir-wvp dir-geometa dir-eoshdf {} 01 01 {} 12 31
